[English](README.md)

# MHMA Account (`mhma_account`)

موديول خفيف لأودو 17 يضيف تعديلات بسيطة لكن مفيدة في **المحاسبة**:
- ربط واستعراض **طبقات تقييم المخزون** (Stock Valuation Layers) مباشرة من القيد/الفاتورة (`account.move`).
- توسيع الوصول إلى **خصائص المحاسبة في جهات الاتصال** لمستخدم المحاسبة (Bookkeeper / Accounting User).
- (اختياري) توفير ملف ترجمة عربي إضافي لمصطلحات المحاسبة في أودو.

> ملاحظة: هذا موديول مخصص. تنسيق التوثيق هنا قريب من أسلوب توثيقات OCA.

## الفهرس
- [نبذة](#نبذة)
- [المميزات](#المميزات)
- [الصلاحيات](#الصلاحيات)
- [التثبيت](#التثبيت)
- [الإعدادات](#الإعدادات)
- [طريقة الاستخدام](#طريقة-الاستخدام)
- [تفاصيل تقنية](#تفاصيل-تقنية)
- [قيود معروفة](#قيود-معروفة)
- [تتبع الأخطاء](#تتبع-الأخطاء)
- [الشكر والاعتمادات](#الشكر-والاعتمادات)
- [الجهة المشرفة](#الجهة-المشرفة)
- [الرخصة](#الرخصة)

## نبذة
`mhma_account` موجه للبيئات التي تعمل على محاسبة أودو مع تقييم مخزون، وتحتاج تتبع أوضح بين:
- القيود المحاسبية (`account.move`)
- طبقات تقييم المخزون (`stock.valuation.layer`)

كما يسهّل وصول مستخدم المحاسبة (Account User) لبعض خصائص المحاسبة في جهات الاتصال حسب الحاجة.

## المميزات

### 1) تبويب “Stock Valuation” داخل القيد المحاسبي
يضيف الموديول صفحة جديدة باسم **Stock Valuation** داخل نموذج `account.move`.

وتحتوي على:
- **قائمة طبقات التقييم المرتبطة** (قراءة فقط) وتعرض:
  - المنتج
  - الكمية
  - القيمة
- **حقل اختيار لربط طبقات تقييم موجودة مسبقًا**
  - حقل Many2many لاختيار سجلات `stock.valuation.layer` الموجودة.
  - عند اختيار السجلات، يقوم الموديول تلقائيًا بكتابة `account_move_id = القيد الحالي` في طبقات التقييم المحددة.

الفائدة العملية:
- مراجعة قيود التقييم وربطها بسهولة أثناء التدقيق.
- تسهيل تتبع أسباب الفروقات أو المعالجات المتعلقة بالتقييم.

### 2) إتاحة خصائص محاسبة جهة الاتصال لمستخدم المحاسبة
يقوم الموديول بتعديل شاشة خصائص المحاسبة في جهات الاتصال (`res.partner`) بحيث تصبح مجموعة **Accounting Entries** متاحة أيضًا لمجموعة:
- **Accounting / Accountant** (`account.group_account_user`)

> ملاحظة: هذا لا يلغي بقية إعدادات الأمان في قاعدة بياناتك، لكنه يوسّع الوصول للواجهة حسب التصميم في الموديول.

### 3) (اختياري) ترجمة عربية إضافية للمحاسبة
الموديول يحتوي ملف ترجمة عربي داخل:
- `mhma_account/i18n_extra/ar.po`

وهذا الملف يحتوي ترجمات عربية لمصطلحات **موديول المحاسبة الأساسي `account`** في أودو (وليس فقط هذا الموديول).
يمكنك استيراده يدويًا إذا رغبت بتحسين/ضبط المصطلحات العربية.

## الصلاحيات
الموديول يضيف صلاحية وصول للموديل:
- `stock.valuation.layer` (من `stock_account`)

للمجموعة:
- **Accounting Manager** (`account.group_account_manager`)

والصلاحيات:
- قراءة ✅
- تعديل ✅
- إنشاء ✅
- حذف ❌ (ممنوع عمدًا)

وهذا مفيد لتجنب مشاكل الصلاحيات عند ربط طبقات التقييم من شاشة المحاسبة.

## التثبيت
1. ضع مجلد `mhma_account` ضمن مسار إضافات أودو.
2. أعد تشغيل السيرفر.
3. فعّل وضع المطور.
4. التطبيقات → تحديث قائمة التطبيقات.
5. ابحث عن `MHMA Account` ثم ثبّت.

## الإعدادات
### المجموعات (Groups)
- لاستخدام ربط طبقات التقييم:
  - يفضّل أن يكون المستخدم **Accounting Manager** إذا كان سيقوم بالربط/التعديل على طبقات التقييم.
- لإتاحة خصائص محاسبة جهة الاتصال لموظف محاسبة:
  - ضع المستخدم ضمن **Accounting / Accountant** (`account.group_account_user`).

### (اختياري) استيراد ملف الترجمة العربي
لاستخدام `i18n_extra/ar.po`:
1. الإعدادات → الترجمات → استيراد/تحميل ترجمة (قد يختلف النص حسب الواجهة)
2. اختر اللغة: العربية
3. اختر ملف الترجمة: `mhma_account/i18n_extra/ar.po`
4. إن طلب منك تحديد الموديول: اختر **account**
5. استيراد.

## طريقة الاستخدام
### ربط طبقات تقييم المخزون مع القيد
1. المحاسبة → القيود اليومية (أو الفواتير).
2. افتح قيدًا موجودًا (`account.move`).
3. انتقل إلى تبويب **Stock Valuation**.
4. راجع السجلات المرتبطة في الجدول.
5. استخدم حقل **Select Stock Valuation Layers** لاختيار طبقات تقييم موجودة.
   - عند الاختيار سيتم ربطها تلقائيًا بالقيد عبر `account_move_id`.

### خصائص محاسبة جهة الاتصال
1. جهات الاتصال → افتح جهة اتصال.
2. انتقل إلى تبويب/قسم المحاسبة (Accounting Properties).
3. مستخدم المحاسبة (Accounting User) سيكون قادرًا على الوصول لمجموعة **Accounting Entries** حسب الأذونات.

## تفاصيل تقنية
- وراثة الموديل:
  - `account.move`
- حقول مضافة:
  - `stock_valuation_ids`: One2many على `stock.valuation.layer` عبر `account_move_id`
  - `stock_valuation_select_ids`: Many2many لاختيار طبقات تقييم موجودة
- منطق الربط:
  - `@api.onchange('stock_valuation_select_ids')` يقوم بعمل `write()` على طبقات التقييم المختارة لتعيين `account_move_id`.

## قيود معروفة
- الربط يعتمد على `move.id` داخل onchange:
  - إذا كان القيد جديدًا ولم يتم حفظه بعد (لا يوجد ID)، قد لا يعمل الربط بالشكل المتوقع.
- الـ onchange يقوم بالكتابة مباشرة على طبقات التقييم:
  - هذا يعني أن الربط يُحفظ حتى لو أغلقت نموذج القيد بدون حفظ التغييرات فيه.
- حقل الاختيار `stock_valuation_select_ids` لا يتم تفريغه تلقائيًا بعد الربط (يبقى الاختيار ظاهرًا).

## تتبع الأخطاء
بلّغ عن الأخطاء وطلبات التحسين عبر GitHub Issues في نفس المستودع.

## الشكر والاعتمادات
### المطور
- مصطفى الأحذل

## الجهة المشرفة
هذا الموديول تحت صيانة وإشراف **مصطفى الأحذل**.

## الرخصة
لم يتم تحديد مفتاح `license` صراحة داخل `__manifest__.py`.
يفضّل إضافة رخصة واضحة (مثل LGPL-3 أو OPL-1) لتجنب أي لبس.
